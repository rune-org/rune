// ⚠️ GENERATED FILE - DO NOT EDIT MANUALLY
// This file is generated from dsl/dsl-definition.json
// To update, modify dsl/dsl-definition.json and run: make dsl-generate

import type { Edge, Node } from "@xyflow/react";
import type { CredentialRef } from "@/lib/credentials";

/** The base data structure that all nodes share. */
export type BaseData = {
  label?: string;
  credential?: CredentialRef | null;
  /** When true, the node's position is preserved during auto-layout. */
  pinned?: boolean;
};

/** A map defining the specific data for each kind of node. */
export type NodeDataMap = {
{% for node_type, node_def in dsl.node_types.items() %}
  {{ node_def.frontend_type }}: BaseData{% if node_def.parameters %} & {
{% for param_name, param_def in node_def.parameters.items() %}
{% set frontend_param_name = node_def.get("frontend_parameter_mapping", {}).get(param_name, param_name) %}
{% if param_name == "rules" and param_def.type == "array" %}
    {{ frontend_param_name }}?: SwitchRule[];
{% elif param_def.get("enum") %}
    {{ frontend_param_name }}?: {% for enum_val in param_def.enum %}"{{ enum_val }}"{% if not loop.last %} | {% endif %}{% endfor %};
{% elif frontend_param_name in ["retries", "retryDelay", "timeout"] %}
    {{ frontend_param_name }}?: number;
{% elif param_def.type == "string" or param_def.type == "string|array" %}
    {{ frontend_param_name }}?: string;
{% elif param_def.type == "number" %}
    {{ frontend_param_name }}?: number;
{% elif param_def.type == "boolean" %}
    {{ frontend_param_name }}?: boolean;
{% elif param_def.type == "object" %}
    {{ frontend_param_name }}?: Record<string, unknown>;
{% elif param_def.type == "array" %}
{% if frontend_param_name in ["cc", "bcc"] %}
    {{ frontend_param_name }}?: string;  // Frontend uses comma-separated string, converted to array in conversion functions
{% else %}
    {{ frontend_param_name }}?: unknown[];
{% endif %}
{% else %}
    {{ frontend_param_name }}?: unknown;
{% endif %}
{% endfor %}
  }{% endif %};
{% endfor %}
};

/** A union type of all possible node kinds. */
export type NodeKind = keyof NodeDataMap;

/** Node schema defining inputs and outputs for each node type. */
// TODO: MANUAL UPDATE REQUIRED - Update inputs/outputs when node types change
// This schema defines the inputs and outputs for each node type in the canvas.
// When adding new node types or changing node behavior, update this schema accordingly.
export const NODE_SCHEMA = {
  trigger: {
    inputs: [],
    outputs: ["trigger"],
  },
  agent: {
    inputs: ["input"],
    outputs: ["response"],
  },
  if: {
    inputs: ["condition"],
    outputs: ["true", "false"],
  },
  switch: {
    inputs: ["input"],
    outputs: [], // dynamic based on configured rules
  },
  http: {
    inputs: ["request"],
    outputs: ["response", "error"],
  },
  smtp: {
    inputs: ["email"],
    outputs: ["sent", "error"],
  },
  log: {
    inputs: ["message"],
    outputs: ["logged"],
  },
} as const satisfies Record<NodeKind, { inputs: readonly string[]; outputs: readonly string[] }>;

export type CanvasNode = {
  [K in NodeKind]: Node<NodeDataMap[K]> & { type: K };
}[NodeKind];

{% for node_type, node_def in dsl.node_types.items() %}
export type {{ node_def.frontend_type | capitalize }}Data = NodeDataMap["{{ node_def.frontend_type }}"];
{% endfor %}

export type CanvasEdge = Edge;

export type SwitchRule = {
  value?: string;
  operator?: SwitchOperator;
  compare?: string;
};

export type SwitchOperator =
  | "=="
  | "!="
  | ">"
  | "<"
  | ">="
  | "<="
  | "contains";
